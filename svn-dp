#!/bin/sh

printUsage()
{
    cat <<HELPTEXT
Diff with predecessor, either current COMMITTED revision to PREV, or
with -c REV revision REV to its predecessor. 
Note: The [@REV] is only a revision peg for use on the server; you cannot
specify a local revision with it. 
Usage: "$(basename "$1")" [-c|--change REV] [TARGET[@REV]...] [-?|-h|--help]
HELPTEXT
}

revisionRange='-r PREV:COMMITTED'
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
    --change|-c)	shift
			# XXX: When supplying an URL target (i.e. server diff,
			# not from working copy), the --old=URL option must be
			# used and -r N:M instead of -c. 
			if [ "${2%%/*}" = 'https:' ]; then
			    revisionRange="-r $(($1 - 1)):${1} --old=$2"
			    shift
			else
			    revisionRange="--change $1"
			fi
			shift
			;;
esac

svnDiffCommand='svn diff'
if which svn-diff >/dev/null 2>&1; then
    svnDiffCommand='svn-diff'
fi
"$svnDiffCommand" $revisionRange "$@"
